<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>è‹±é›„åˆ—è¡¨</title>
    <!-- å¯¼å…¥jquery -->
    <script src="/node_modules/jquery/dist/jquery.min.js"></script>
    <!-- å¯¼å…¥bootstrap -->
    <link rel="stylesheet" href="/node_modules/bootstrap/dist/css/bootstrap.css">
    <script src="/node_modules/bootstrap/dist/js/bootstrap.js"></script>
    <!-- å¯¼å…¥art-template -->
    <script src="/node_modules/art-template/lib/template-web.js"></script>

</head>

<body>
<!-- bootstrapçš„å®¹å™¨  å¸¦ç‰ˆå¿ƒçš„-->
<div class="container">
    <!-- å¯¼èˆª -->
    <nav class="navbar navbar-default">
        <div class=".container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="#">æ¬¢è¿è¿›å…¥CQåå°ç®¡ç†</a>
            </div>
            <!-- ç”¨æˆ·ç™»å½•ä¿¡æ¯ -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="#" id="userName">å¼ ä¸‰</a></li>
                    <li>
                        <button class="btn btn-danger btn-exit" id="logout" onclick="location.href='/logout'">é€€å‡º
                        </button>
                    </li>
                    <li>
                        <button class="btn btn-success" id="login" onclick="location.href='/resource/view/login.html'">
                            è¯·ç™»å½•
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- åº•éƒ¨çš„å†…å®¹ -->
    <div class="row">
        <!-- æ …æ ¼å¸ƒå±€ -->
        <div class=".col-md-9">
            <div class="panel panel-default">
                <!-- æ ‡é¢˜ -->
                <div class="panel-heading">
                    <h3 class="panel-title">
                        <!-- é¢åŒ…å±‘å¯¼èˆª -->
                        <ol class="breadcrumb">
                            <li><a href="#">é¦–é¡µ</a></li>
                            <li class="active">è‹±é›„åˆ—è¡¨</li>
                        </ol>
                    </h3>
                </div>
                <!-- æ ‡é¢˜ -->
                <div class="panel-heading">
                    <!-- è¡¨å• -->
                    <form class="form-inline">
                        <div class="form-group">
                            <label class="sr-only" for="search">Amount (in dollars)</label>
                            <div class="input-group">
                                <div class="input-group-addon">è‹±é›„å§“å</div>
                                <input type="text" class="form-control" id="search" placeholder="è¯·è¾“å…¥æŸ¥è¯¢å†…å®¹"/>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success btn-search">æŸ¥æ‰¾</button>
                        <button type="button" class="btn btn-warning"
                                onclick="location.href='/resource/view/insert.html'">æ–°å¢
                        </button>
                    </form>
                    <!-- åˆ†é¡µ -->
                    <nav aria-label="Page navigation">
                        <ul class="pagination">
                            <script id="pageTmp" type="text/html">
                                <% for(var i = 1; i <= pageCount; i++){ %>
                                <li class="page">
                                    <a href="javascript:void(0)"><%= i %> </a>
                                </li>
                                <% } %>
                            </script>
                        </ul>
                    </nav>
                </div>
                <!-- å†…å®¹ -->
                <div class="panel-body">
                    <table class="table table-bordered">
                        <!-- å¤´éƒ¨ -->
                        <thead>
                        <tr>
                            <th>å§“å</th>
                            <th>æŠ€èƒ½</th>
                            <th>å¤´åƒ</th>
                            <th>æ“ä½œ</th>
                        </tr>
                        </thead>
                        <!-- èº«ä½“ -->
                        <tbody>
                        <!-- æ¨¡æ¿å¼•æ“ -->
                        <script id="heroListTmp" type="text/html">
                            {{ each heros }}
                            <tr>
                                <td>{{ $value.name }}</td>
                                <td>{{ $value.skill }}</td>
                                <td><img src="/resource/{{ $value.icon }}" width="72px" height="72px"></td>
                                <td class="manager">
                                    <button class="btn btn-success" onclick="window.name='{{$value.name}},{{$value.skill}},{{$value._id}},{{$value.icon}}';location.href='/resource/view/update.html'">ç¼–è¾‘ğŸ·</button>
                                    <button class="btn btn-danger" onclick="location.href='/heroDelete?_id={{ $value._id}}'">åˆ é™¤ğŸ‘</button>
                                </td>
                            </tr>
                            {{ /each }}
                        </script>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
        $(function () {

            console.log(document.cookie);

            //1.è‹±é›„åˆ—è¡¨
            $.ajax({
                url: '/heroList',
                type: 'get',
                dataType: 'json',
                success: function (data) {
                    console.log(data);

                    $('tbody').html(template('heroListTmp', data)); //æ¸²æŸ“åˆ—è¡¨
                    $('.pagination').html(template('pageTmp', data)); //æ¸²æŸ“é¡µç 

                    //åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•
                    if (data.user) {//å·²ç»ç™»å½•è¿‡
                        console.log(data.user);
                        $('#userName').text(data.user.userName);
                        $('#login').hide();
                    } else {//æœªç™»å½•
                        $('#userName').hide();
                        $('#logout').hide();
                        $('.manager').hide();
                    }

                    //2.åˆ†é¡µæŸ¥è¯¢(å¿…é¡»è¦ç­‰é¡µç æ¸²æŸ“ä¹‹åæ‰å¯ä»¥è·å–åˆ°é¡µç liå…ƒç´ )
                    $('.page').on('click', function () {
                        $.ajax({
                            url: '/heroPage?page=' + $(this).text(),
                            type: 'get',
                            dataType: 'json',
                            success: function (data) {
                                console.log(data);
                                $('tbody').html(template('heroListTmp', data)); //æ¸²æŸ“åˆ—è¡¨

                            }
                        });
                    });
                }
            });

            //3.æœç´¢æŒ‰é’®
            $('.btn-search').on('click', function () {
                if ($('#search').val().length == 0) {//å¦‚æœæ²¡æœ‰è¾“å…¥ï¼Œä¸å‘é€è¯·æ±‚
                    return;
                }

                $.ajax({
                    url: '/heroSearch?searchStr=' + $('#search').val(),
                    type: 'get',
                    dataType: 'json',
                    success: function (data) {
                        console.log(data);
                        $('tbody').html(template('heroListTmp', data)); //æ¸²æŸ“åˆ—è¡¨
                        //æ¸…ç©ºæœç´¢æ¡†
                        $('#search').val('');
                    }
                });
            });
        })
</script>
</body>
</html>
